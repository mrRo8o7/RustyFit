<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RustyFit</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; margin: 0; padding: 0; background: #f4f6fb; color: #0f172a; }
    header { background: linear-gradient(120deg, #111827, #1f2937); color: white; padding: 1.2rem 2.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    h1 { margin: 0; font-weight: 700; letter-spacing: -0.02em; }
    main { padding: 2.5rem 1.5rem 3rem; max-width: 1100px; margin: 0 auto; }
    .drop-zone { border: 2px dashed #cbd5e1; padding: 2.5rem; background: white; text-align: center; border-radius: 16px; transition: all 0.2s ease; box-shadow: 0 14px 40px rgba(15, 23, 42, 0.08); }
    .drop-zone.drag { border-color: #2563eb; background: #eef2ff; box-shadow: 0 20px 45px rgba(37, 99, 235, 0.18); }
    .status { margin-top: 1rem; min-height: 1.5rem; }
    button { background: linear-gradient(120deg, #2563eb, #7c3aed); color: white; border: none; padding: 0.85rem 1.6rem; border-radius: 10px; cursor: pointer; font-weight: 600; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.25); transition: transform 0.15s ease, box-shadow 0.15s ease; }
    button:hover { transform: translateY(-2px); box-shadow: 0 14px 30px rgba(79, 70, 229, 0.28); }
    .error { color: #b91c1c; font-weight: bold; }
    .records { margin-top: 1.5rem; }
    .options { margin: 1.2rem 0; display: flex; gap: 1rem; align-items: center; color: #334155; font-weight: 500; }
    .results-card { background: white; border-radius: 16px; padding: 1.25rem 1.5rem; box-shadow: 0 16px 45px rgba(15, 23, 42, 0.08); margin-top: 1.5rem; }
    .results-header { display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
    .eyebrow { text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; font-size: 0.78rem; margin: 0 0 0.25rem 0; }
    .cta { text-decoration: none; background: linear-gradient(120deg, #10b981, #22d3ee); color: #0f172a; padding: 0.8rem 1.2rem; border-radius: 12px; font-weight: 700; box-shadow: 0 12px 30px rgba(16, 185, 129, 0.25); transition: transform 0.15s ease; }
    .cta:hover { transform: translateY(-1px); }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 1rem; }
    .summary-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1rem; }
    .label { margin: 0; font-size: 0.9rem; color: #64748b; font-weight: 600; }
    .value { margin: 0.15rem 0 0; font-size: 1.45rem; font-weight: 800; color: #0f172a; }
    .table-wrapper { overflow-x: auto; margin-top: 1rem; }
    table { border-collapse: collapse; width: 100%; background: white; border-radius: 12px; overflow: hidden; }
    th { background: #0f172a; color: white; text-align: left; padding: 0.75rem; font-weight: 700; }
    td { padding: 0.65rem; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
    tr:nth-child(even) td { background: #f8fafc; }
    ul { margin: 0.25rem 0 0; padding-left: 1.2rem; }
    @media (max-width: 600px) {
      .results-header { flex-direction: column; align-items: flex-start; }
      button { width: 100%; }
      .cta { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>
  <header><h1>RustyFit MVP</h1></header>
  <main>
    <p>Upload a FIT file to begin preprocessing.</p>
    <div class="options">
      <label><input type="checkbox" id="remove-speed" /> Remove speed fields</label>
      <label><input type="checkbox" id="smooth-speed" /> Smooth speed (windowed)</label>
    </div>
    <div id="drop-zone" class="drop-zone">
      <p>Drag & drop your FIT file here, or click to select.</p>
      <input id="file-input" type="file" accept=".fit" style="display:none" />
      <button id="select-btn" type="button">Choose a file</button>
    </div>
    <div class="status" id="status"></div>
    <div id="results" class="records"></div>
  </main>
  <script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const selectBtn = document.getElementById('select-btn');
    const statusEl = document.getElementById('status');
    const resultsEl = document.getElementById('results');
    const removeSpeedCheckbox = document.getElementById('remove-speed');
    const smoothSpeedCheckbox = document.getElementById('smooth-speed');

    const preventDefaults = (e) => { e.preventDefault(); e.stopPropagation(); };
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.add('drag'), false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag'), false);
    });

    dropZone.addEventListener('click', () => fileInput.click());
    selectBtn.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('drop', handleFiles);
    fileInput.addEventListener('change', (e) => handleFiles({ dataTransfer: { files: e.target.files } }));

    async function handleFiles(e) {
      const files = e.dataTransfer.files;
      if (!files || files.length === 0) {
        return;
      }
      const formData = new FormData();
      formData.append('file', files[0]);
      formData.append('remove_speed_fields', removeSpeedCheckbox.checked ? 'true' : 'false');
      formData.append('smooth_speed', smoothSpeedCheckbox.checked ? 'true' : 'false');
      statusEl.textContent = 'Uploading...';
      resultsEl.innerHTML = '';
      try {
        const response = await fetch('/upload', { method: 'POST', body: formData });
        const message = await response.text();
        if (response.ok) {
          statusEl.textContent = 'Processed successfully';
          resultsEl.innerHTML = message;
        } else {
          statusEl.innerHTML = '<span class="error">Upload failed: ' + message + '</span>';
        }
      } catch (err) {
        statusEl.innerHTML = '<span class="error">Upload failed: ' + err + '</span>';
      }
    }
  </script>
</body>
</html>
